<?xml version="1.0"?>
<odoo>
  <data>
    <!-- ✅ Vista de formulario del wizard – Odoo 17 CE compatible -->
    <record id="view_service_complete_wizard_form" model="ir.ui.view">
      <field name="name">inmoser.service.complete.wizard.form</field>
      <field name="model">inmoser.service.complete.wizard</field>
      <field name="arch" type="xml">
        <form title="Complete Service">
          <sheet>
            <div class="oe_title">
              <h1>
                <span>Complete Service Order</span>
              </h1>
            </div>
            <group>
              <field name="service_order_id" readonly="1"></field>
              <field name="completion_time"></field>
            </group>
            <notebook>
              <page title="Diagnosis &amp; Work" name="diagnosis_work">
                <group>
                  <field name="diagnosis" nolabel="1" placeholder="Describe the technical diagnosis of the equipment issue..."></field>
                </group>
                <group title="Work Performed">
                  <field name="work_performed" nolabel="1" placeholder="Describe in detail the work performed to fix the issue..."></field>
                </group>
                <group title="Additional Information">
                  <field name="technician_notes" placeholder="Any additional notes or observations..."></field>
                  <field name="customer_satisfaction"></field>
                </group>
              </page>
              <page title="Parts &amp; Refactions" name="refactions">
                <group>
                  <field name="requires_parts"></field>
                </group>
                <field name="refaction_line_ids" invisible="not requires_parts">
                  <tree editable="bottom">
                    <field name="product_id" title="Product"></field>
                    <field name="description" title="Description"></field>
                    <field name="quantity" title="Qty"></field>
                    <field name="unit_price" title="Unit Price"></field>
                    <field name="total_price" title="Total" readonly="1"></field>
                  </tree>
                </field>
              </page>
              <page title="Photo Evidence" name="photos">
                <group title="Before Service">
                  <field name="photo_before" widget="image" options="{'size': [300, 200]}"></field>
                </group>
                <group title="After Service">
                  <field name="photo_after" widget="image" options="{'size': [300, 200]}"></field>
                </group>
              </page>
              <page title="Customer Signature" name="signature">
                <group>
                  <field name="customer_signature" widget="signature" title="Customer Signature"></field>
                </group>
                <div class="alert alert-info" role="alert"><strong>Note:</strong> The customer signature confirms that the service has been completed to their satisfaction and they approve the work performed.
                                </div>
              </page>
            </notebook>
          </sheet>
          <footer>
            <button name="action_complete_service" type="object" title="Complete Service" class="oe_highlight"/>
            <button title="Cancel" class="oe_link" special="cancel"/>
          </footer>
        </form>
      </field>
    </record>
    <!-- ✅ Acción del wizard -->
    <record id="action_service_complete_wizard" model="ir.actions.act_window">
      <field name="name">Complete Service Order</field>
      <field name="res_model">inmoser.service.complete.wizard</field>
      <field name="view_mode">form</field>
      <field name="view_id" ref="view_service_complete_wizard_form"></field>
      <field name="target">new</field>
    </record>
    <!-- ✅ Vista de calendario – Odoo 17 CE compatible -->
    <record id="view_service_order_calendar_technician" model="ir.ui.view">
      <field name="name">inmoser.service.order.calendar.technician</field>
      <field name="model">inmoser.service.order</field>
      <field name="arch" type="xml">
        <calendar title="Technician Calendar" date_start="scheduled_date" date_stop="scheduled_date" color="state" quick_add="False" js_class="technician_calendar">
          <field name="name"></field>
          <field name="partner_id"></field>
          <field name="equipment_id"></field>
          <field name="service_type_id"></field>
          <field name="assigned_technician_id"></field>
          <field name="state"></field>
          <field name="priority"></field>
          <field name="reported_fault"></field>
        </calendar>
      </field>
    </record>
    <!-- ✅ Acción de calendario para técnicos -->
    <record id="action_service_order_calendar_technician" model="ir.actions.act_window">
      <field name="name">My Service Calendar</field>
      <field name="res_model">inmoser.service.order</field>
      <field name="view_mode">calendar,tree,form</field>
      <field name="view_id" ref="view_service_order_calendar_technician"></field>
      <field name="domain">[('assigned_technician_id.user_id', '=', uid)]</field>
      <field name="context">{
                'search_default_my_services': 1,
                'search_default_today': 1,
                'default_assigned_technician_id': context.get('default_technician_id', False)
            }</field>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">No services scheduled for you today!</p>
        <p>This calendar shows all service orders assigned to you. Click on any service to view details, start work, or complete the service.</p>
      </field>
    </record>
    <!-- ✅ Menú para técnicos -->
    <menuitem id="menu_technician_calendar" name="My Calendar" parent="menu_inmoser_service_orders" action="action_service_order_calendar_technician" sequence="5"/>
  </data>
</odoo>
