<?xml version="1.0"?>
<odoo>
  <data>
    <!-- ✅ Vista formulario – Odoo 17 CE compatible -->
    <record id="view_service_type_form" model="ir.ui.view">
      <field name="name">inmoser.service.type.form</field>
      <field name="model">inmoser.service.type</field>
      <field name="arch" type="xml">
        <form string="Service Type">
          <sheet>
            <div class="oe_button_box" name="button_box">
              <button name="action_view_service_orders" type="object" class="oe_stat_button" icon="fa-list">
                <field name="service_order_count" widget="statbutton" string="Service Orders"></field>
              </button>
            </div>
            <div class="oe_title">
              <h1>
                <field name="name" placeholder="Service Type Name..."></field>
              </h1>
            </div>
            <group>
              <group name="basic_info" string="Basic Information">
                <field name="description"></field>
                <field name="active"></field>
                <field name="sequence"></field>
                <field name="color" widget="color"></field>
              </group>
              <group name="service_config" string="Service Configuration">
                <field name="estimated_duration" widget="float_time"></field>
                <field name="requires_diagnosis"></field>
                <field name="requires_approval"></field>
                <field name="allow_photos"></field>
              </group>
            </group>
            <notebook>
              <page string="Pricing" name="pricing">
                <group>
                  <group string="Base Pricing">
                    <field name="base_price"></field>
                    <field name="currency_id"></field>
                  </group>
                  <group string="Statistics">
                    <field name="avg_completion_time" readonly="1" widget="float_time"></field>
                  </group>
                </group>
              </page>
              <page string="Default Products" name="default_products">
                <field name="default_product_ids">
                  <tree>
                    <field name="name" string="Product"></field>
                    <field name="default_code" string="Reference"></field>
                    <field name="list_price" string="Price"></field>
                    <field name="uom_id" string="Unit"></field>
                  </tree>
                </field>
              </page>
              <page string="Template Image" name="template_image">
                <group>
                  <group string="Template Configuration">
                    <field name="template_image" widget="image" options="{'size': [300, 200]}"></field>
                  </group>
                  <group string="Usage">
                    <div>
                      <p>The template image is used to customize the service order format and can be included in reports and customer communications.</p>
                    </div>
                  </group>
                </group>
              </page>
              <page string="Service Orders" name="service_orders">
                <field name="service_order_ids" readonly="1">
                  <tree>
                    <field name="name" string="Reference"></field>
                    <field name="partner_id" string="Customer"></field>
                    <field name="equipment_id" string="Equipment"></field>
                    <field name="assigned_technician_id" string="Technician"></field>
                    <field name="scheduled_date" string="Scheduled"></field>
                    <field name="state" widget="badge"></field>
                    <field name="total_amount" string="Total"></field>
                  </tree>
                </field>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>
    <!-- ✅ Vista lista – Odoo 17 CE compatible -->
    <record id="view_service_type_tree" model="ir.ui.view">
      <field name="name">inmoser.service.type.tree</field>
      <field name="model">inmoser.service.type</field>
      <field name="arch" type="xml">
        <tree decoration-muted="not active">
          <field name="sequence" widget="handle"></field>
          <field name="name" string="Name"></field>
          <field name="description" string="Description"></field>
          <field name="estimated_duration" widget="float_time" string="Duration"></field>
          <field name="base_price" string="Price"></field>
          <field name="currency_id" invisible="1"></field>
          <field name="requires_diagnosis" widget="boolean_toggle" string="Diagnosis"></field>
          <field name="requires_approval" widget="boolean_toggle" string="Approval"></field>
          <field name="allow_photos" widget="boolean_toggle" string="Photos"></field>
          <field name="service_order_count" string="Orders"></field>
          <field name="avg_completion_time" widget="float_time" string="Avg Time"></field>
          <field name="active" invisible="1"></field>
        </tree>
      </field>
    </record>
    <!-- ✅ Vista kanban – Odoo 17 CE compatible -->
    <record id="view_service_type_kanban" model="ir.ui.view">
      <field name="name">inmoser.service.type.kanban</field>
      <field name="model">inmoser.service.type</field>
      <field name="arch" type="xml">
        <kanban class="o_kanban_mobile">
          <field name="name"></field>
          <field name="description"></field>
          <field name="estimated_duration"></field>
          <field name="base_price"></field>
          <field name="currency_id"></field>
          <field name="service_order_count"></field>
          <field name="color"></field>
          <templates>
            <t t-name="kanban-box">
              <div class="oe_kanban_card oe_kanban_global_click" t-attf-style="border-left: 4px solid #{kanban_color(record.color.raw_value)};">
                <div class="oe_kanban_content">
                  <div class="oe_kanban_details">
                    <strong class="o_kanban_record_title">
                      <field name="name"></field>
                    </strong>
                    <div class="o_kanban_record_subtitle">
                      <field name="description"></field>
                    </div>
                    <div class="o_kanban_record_body">
                      <div class="row">
                        <div class="col-6">
                          <i title="clock-o" aria-label="clock-o" class="fa fa-clock-o"/>
                          <field name="estimated_duration" widget="float_time"></field>
                        </div>
                        <div class="col-6">
                          <i title="money" aria-label="money" class="fa fa-money"/>
                          <field name="base_price" widget="monetary"></field>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="oe_kanban_footer">
                  <div class="oe_kanban_footer_left">
                    <span t-if="record.service_order_count.raw_value &gt; 0"><field name="service_order_count"></field> orders
                                        </span>
                  </div>
                </div>
              </div>
            </t>
          </templates>
        </kanban>
      </field>
    </record>
    <!-- ✅ Vista de búsqueda – Odoo 17 CE compatible -->
    <record id="view_service_type_search" model="ir.ui.view">
      <field name="name">inmoser.service.type.search</field>
      <field name="model">inmoser.service.type</field>
      <field name="arch" type="xml">
        <search string="Service Types">
          <field name="name" string="Service Type"></field>
          <field name="description" string="Description"></field>
          <filter string="Active" name="active" domain="[('active', '=', True)]"/>
          <filter string="Inactive" name="inactive" domain="[('active', '=', False)]"/>
          <filter string="Requires Diagnosis" name="requires_diagnosis" domain="[('requires_diagnosis', '=', True)]"/>
          <filter string="Requires Approval" name="requires_approval" domain="[('requires_approval', '=', True)]"/>
          <filter string="Allows Photos" name="allows_photos" domain="[('allow_photos', '=', True)]"/>
          <group expand="0" string="Group By">
            <filter string="Requires Diagnosis" name="group_diagnosis" context="{'group_by': 'requires_diagnosis'}"/>
            <filter string="Requires Approval" name="group_approval" context="{'group_by': 'requires_approval'}"/>
            <filter string="Duration Range" name="group_duration" context="{'group_by': 'estimated_duration'}"/>
          </group>
        </search>
      </field>
    </record>
    <!-- ✅ Acción principal – Odoo 17 CE compatible -->
    <record id="action_service_type" model="ir.actions.act_window">
      <field name="name">Service Types</field>
      <field name="res_model">inmoser.service.type</field>
      <field name="view_mode">kanban,tree,form</field>
      <field name="search_view_id" ref="view_service_type_search"></field>
      <field name="context">{'search_default_active': 1}</field>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">Create your first service type!</p>
        <p>Service types define the different kinds of services you offer, their pricing, duration, and requirements.</p>
      </field>
    </record>
  </data>
</odoo>
