<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <template id="equipment_history_document">
      <t t-call="web.html_container">
        <!-- Contexto con lenguaje del cliente -->
        <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)"/>
        <div class="page" style="font-family: Arial, sans-serif; padding: 20px;">
          <!-- Encabezado -->
          <div style="text-align: center; margin-bottom: 30px;">
            <h1 style="color: #2E86AB;">HISTORIAL DE SERVICIOS</h1>
            <h2><t t-out="doc.name"/> - <t t-out="doc.equipment_type or ''"/></h2>
            <p>Cliente: <t t-out="doc.partner_id.name or ''"/></p>
          </div>
          <!-- Información del equipo -->
          <div style="margin-bottom: 20px;">
            <h3>Información del Equipo</h3>
            <table style="width: 100%; border-collapse: collapse;">
              <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">
                  <strong>Marca:</strong>
                </td>
                <td style="padding: 10px; border: 1px solid #ddd;">
                  <t t-out="doc.brand or ''"/>
                </td>
              </tr>
              <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">
                  <strong>Modelo:</strong>
                </td>
                <td style="padding: 10px; border: 1px solid #ddd;">
                  <t t-out="doc.model or ''"/>
                </td>
              </tr>
              <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">
                  <strong>Número de Serie:</strong>
                </td>
                <td style="padding: 10px; border: 1px solid #ddd;">
                  <t t-out="doc.serial_number or ''"/>
                </td>
              </tr>
              <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">
                  <strong>Total de Servicios:</strong>
                </td>
                <td style="padding: 10px; border: 1px solid #ddd;">
                  <t t-out="len(doc.service_order_ids or [])"/>
                </td>
              </tr>
            </table>
          </div>
          <!-- Historial de servicios -->
          <div style="margin-bottom: 20px;">
            <h3>Historial de Servicios</h3>
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: #2E86AB; color: white;">
                  <th style="padding: 8px;">Orden</th>
                  <th style="padding: 8px;">Tipo de Servicio</th>
                  <th style="padding: 8px;">Técnico</th>
                  <th style="padding: 8px;">Fecha</th>
                  <th style="padding: 8px;">Estado</th>
                  <th style="padding: 8px;">Diagnóstico</th>
                </tr>
              </thead>
              <tbody>
                <tr t-foreach="doc.service_order_ids or []" t-as="order">
                  <td style="padding: 8px; border: 1px solid #ddd;">
                    <t t-out="order.name or ''"/>
                  </td>
                  <td style="padding: 8px; border: 1px solid #ddd;">
                    <t t-out="order.service_type_id.name or ''"/>
                  </td>
                  <td style="padding: 8px; border: 1px solid #ddd;">
                    <t t-out="order.assigned_technician_id.name or ''"/>
                  </td>
                  <td style="padding: 8px; border: 1px solid #ddd;">
                    <t t-out="fields.Datetime.context_timestamp(order, order.scheduled_date).strftime('%Y-%m-%d %H:%M') if order.scheduled_date else ''"/>
                  </td>
                  <td style="padding: 8px; border: 1px solid #ddd;">
                    <t t-out="order.get_state_label() if hasattr(order, 'get_state_label') else order.state or ''"/>
                  </td>
                  <td style="padding: 8px; border: 1px solid #ddd;">
                    <t t-out="order.diagnosis or ''"/>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- Pie de página -->
          <div style="text-align: center; margin-top: 40px; font-size: 12px; color: #666;">
            <t t-set="now" t-value="fields.Datetime.context_timestamp(doc, fields.Datetime.now())"/>
            <p>Historial generado el <t t-out="now.strftime('%Y-%m-%d %H:%M')"/></p>
            <p>Inmoser México - www.inmosermexico.com</p>
          </div>
        </div>
      </t>
    </template>
  </data>
</odoo>
